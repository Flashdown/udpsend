name: Build udpsend

on:
  push:
    tags:
      - '*'

jobs:
  build:
    name: Build on ${{ matrix.os }}
    runs-on: ${{ matrix.os }}
    strategy:
      matrix:
        os: [ubuntu-latest, windows-latest, macos-latest]

    steps:
      # Checkout code
      - name: Checkout code
        uses: actions/checkout@v3

      # Debug step: List files
      - name: List files in the repository
        run: ls -la

      # Linux: Set up C++ compiler
 #     - name: Set up C++ compiler (Linux)
 #       if: runner.os == 'Linux'
 #       run: |
 #         sudo apt-get update
 #         sudo apt-get install -y g++ make

      # macOS: Set up C++ compiler
#      - name: Set up C++ compiler (macOS)
#        if: runner.os == 'macOS'
#        run: |
#          brew update
#          brew install gcc make

      # Windows: Set up MSVC environment
      - name: Set up MSVC compiler
        if: runner.os == 'Windows'
        shell: cmd
        run: |
          call "C:\Program Files (x86)\Microsoft Visual Studio\2019\Community\VC\Auxiliary\Build\vcvars64.bat"

      # Build the program
#      - name: Build udpsend (Linux)
#        if: runner.os == 'Linux'
#        run: |
#          g++ -o udpsend udpsend.cpp

#      - name: Build udpsend (macOS)
#        if: runner.os == 'macOS'
#        run: |
#          g++ -o udpsend udpsend.cpp

      - name: Build udpsend (Windows)
        if: runner.os == 'Windows'
        shell: cmd
        run: |
          cl /EHsc udpsend.cpp ws2_32.lib /Feudpsend.exe

      # Test the program (optional)
#      - name: Test udpsend (Linux)
#        if: runner.os == 'Linux'
#        run: |
#          echo "Testing udpsend on Linux"
#          ./udpsend 127.0.0.1 12345 "Test Message"

#      - name: Test udpsend (macOS)
#        if: runner.os == 'macOS'
#        run: |
#          echo "Testing udpsend on macOS"
#          ./udpsend 127.0.0.1 12345 "Test Message"

      - name: Test udpsend (Windows)
        if: runner.os == 'Windows'
        shell: cmd
        run: |
          echo "Testing udpsend on Windows"
          udpsend.exe 127.0.0.1 12345 "Test Message"
